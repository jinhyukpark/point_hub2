<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PointHub - í…ŒìŠ¤íŠ¸ í•¨ìˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .auth-status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .auth-status.not-authenticated {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .auth-status.authenticated {
            background: #d4edda;
            color: #155724;
            border: 1px solid #28a745;
        }

        .user-info {
            font-weight: bold;
            margin-top: 5px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .test-section h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .test-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .helper-text {
            font-size: 12px;
            color: #666;
        }

        label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        input {
            padding: 10px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-primary {
            background: #667eea;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª PointHub í…ŒìŠ¤íŠ¸ í•¨ìˆ˜</h1>
        <p class="subtitle">ë¡œì»¬ì—ì„œ ê²Œì„ ì •ì‚° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

        <!-- ì¸ì¦ ìƒíƒœ -->
        <div id="authStatus" class="auth-status not-authenticated">
            <div>â³ Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...</div>
            <div id="userInfo" class="user-info" style="display: none;"></div>
        </div>

        <!-- Matching Game í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ¯ Matching Game í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>testMatchingGameSettlement:</strong> Matching ê²Œì„ì„ ì¢…ë£Œ ìƒíƒœë¡œ ë³€ê²½í•˜ê³  ê²°ê³¼ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
            </div>
            <form class="test-form" id="matchingForm">
                <div class="form-group">
                    <label for="matchingGameId">Game ID *</label>
                    <input type="text" id="matchingGameId" placeholder="ì˜ˆ: matching_order_1764374403788" required>
                </div>
                <button type="submit" class="btn-primary">
                    ì •ì‚° ì‹¤í–‰
                </button>
            </form>
            <div id="matchingResult"></div>
        </div>

        <!-- Matching Game Fixed Winning Numbers í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ² Matching Game Fixed Winning Numbers í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>testMatchingGameWithWinningNumbers:</strong> Matching ê²Œì„ì—ì„œ ìµœì¢… ê²°ê³¼(winningNumbers)ë¥¼ ì§€ì •í•˜ê³  ì •ì‚°í•©ë‹ˆë‹¤.
                <br><br>
                <strong>Winning Numbers:</strong> [BTC, ETH, XRP, BNB, SOL, DOGE, TRX] ìˆœì„œë¡œ 7ê°œ ìˆ«ì (0-9)
            </div>
            <form class="test-form" id="matchingFixedWinningForm">
                <div class="form-group">
                    <label for="matchingFixedGameId">Game ID *</label>
                    <input type="text" id="matchingFixedGameId" placeholder="ì˜ˆ: matching_order_1764374403788" required>
                </div>
                <div class="form-group">
                    <label>Winning Numbers * (7ê°œ ìˆ«ì, 0-9)</label>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 5px;">
                        <input type="number" id="winningBTC" placeholder="BTC" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningETH" placeholder="ETH" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningXRP" placeholder="XRP" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningBNB" placeholder="BNB" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningSOL" placeholder="SOL" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningDOGE" placeholder="DOGE" min="0" max="9" required style="text-align: center;">
                        <input type="number" id="winningTRX" placeholder="TRX" min="0" max="9" required style="text-align: center;">
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        ìˆœì„œ: BTC â†’ ETH â†’ XRP â†’ BNB â†’ SOL â†’ DOGE â†’ TRX
                    </div>
                </div>
                <button type="submit" class="btn-primary">
                    ê³ ì • Winning Numbersë¡œ ì •ì‚° ì‹¤í–‰
                </button>
            </form>
            <div id="matchingFixedWinningResult"></div>
        </div>

        <!-- Cube Game í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ² Cube Game í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>ì‚¬ìš© ì¤‘ì§€:</strong> ìˆ˜ë™ ì •ì‚° ë¡œì§ì´ ê³ ì • Move í…ŒìŠ¤íŠ¸ë¡œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì€ ë” ì´ìƒ ì‹¤ í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>
            <form class="test-form" id="cubeForm">
                <div class="form-group">
                    <label for="cubeGameId">Game ID *</label>
                    <input type="text" id="cubeGameId" placeholder="ì˜ˆ: cube_1764374403788" required>
                </div>
                <button type="submit" class="btn-primary">
                    ì •ì‚° ì‹¤í–‰ (ë¹„í™œì„±í™”)
                </button>
            </form>
            <div id="cubeResult"></div>
        </div>

        <!-- Cube Game Fixed Move í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ¯ Cube Game Fixed Move í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>testCubeGameWithFixedMove:</strong> Cube ê²Œì„ì—ì„œ MoveDirectionê³¼ MoveDistanceë¥¼ ê³ ì •í•˜ê³  ì •ì‚°í•©ë‹ˆë‹¤.
                <br><br>
                <strong>Direction:</strong> -1 (ì™¼ìª½) ë˜ëŠ” 1 (ì˜¤ë¥¸ìª½)
                <br>
                <strong>MoveDistance:</strong> 0 ì´ìƒì˜ ìˆ«ì
                <br><br>
                <strong>ë¹ˆ Pot ì²˜ë¦¬:</strong> í•„ìš” ì‹œ ë¹„ì–´ìˆëŠ” ëª¨ë“  Potì„ ì§€ì •í•œ í…ŒìŠ¤íŠ¸ ìœ ì €ë¡œ ìë™ ì±„ì›Œ ì •ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ì°¸ê°€ìëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
            </div>
            <form class="test-form" id="cubeFixedMoveForm">
                <div class="form-group">
                    <label for="cubeFixedMoveGameId">Game ID (ì„ íƒì‚¬í•­, ë¹„ìš°ë©´ í˜„ì¬ í™œì„± ê²Œì„ ì‚¬ìš©)</label>
                    <input type="text" id="cubeFixedMoveGameId" placeholder="ì˜ˆ: cube_1764374403788">
                </div>
                <div class="form-group">
                    <label for="cubeDirection">Direction * (-1: ì™¼ìª½, 1: ì˜¤ë¥¸ìª½)</label>
                    <input type="number" id="cubeDirection" placeholder="-1 ë˜ëŠ” 1" min="-1" max="1" step="1" required>
                </div>
                <div class="form-group">
                    <label for="cubeMoveDistance">Move Distance * (0 ì´ìƒì˜ ìˆ«ì)</label>
                    <input type="number" id="cubeMoveDistance" placeholder="ì˜ˆ: 123" min="0" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="cubeFillEmpty" checked>
                        ë¹ˆ Potì„ í…ŒìŠ¤íŠ¸ìš© ì°¸ê°€ìë¡œ ìë™ ì±„ìš°ê¸°
                    </label>
                    <div class="helper-text">ì´ë¯¸ ì°¸ì—¬í•œ Potì€ ìœ ì§€ë˜ë©°, ë¹„ì–´ìˆëŠ” ìœ„ì¹˜ë§Œ ë”ë¯¸ ì°¸ê°€ìë¡œ ì±„ì›ë‹ˆë‹¤.</div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="cubeUseAuthFiller">
                        í˜„ì¬ ë¡œê·¸ì¸í•œ ê³„ì •ì„ í…ŒìŠ¤íŠ¸ ìœ ì €ë¡œ ì‚¬ìš©
                    </label>
                    <div class="helper-text">ì²´í¬í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ UID/Email ì •ë³´ë¡œ ìƒì„±ëœ ê°€ìƒ ì°¸ê°€ìê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.</div>
                </div>
                <div class="form-group" id="cubeFillerFields">
                    <label for="cubeFillerUid">í…ŒìŠ¤íŠ¸ ìœ ì € UID (ì„ íƒ)</label>
                    <input type="text" id="cubeFillerUid" placeholder="ì˜ˆ: cube_test_user" value="cube_test_user">
                    <label for="cubeFillerEmail">í…ŒìŠ¤íŠ¸ ìœ ì € Email (ì„ íƒ)</label>
                    <input type="email" id="cubeFillerEmail" placeholder="ì˜ˆ: cube_test_user@pointhub.dev" value="cube_test_user@pointhub.dev">
                </div>
                <button type="submit" class="btn-primary">
                    ê³ ì • Moveë¡œ ì •ì‚° ì‹¤í–‰
                </button>
            </form>
            <div id="cubeFixedMoveResult"></div>
        </div>

        <!-- Cube Game Fill í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ‘¥ Cube Game Fill í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>testFillCubeGame:</strong> í˜„ì¬ í™œì„± Cube ê²Œì„ì„ ë”ë¯¸ ì°¸ê°€ìë¡œ ê°€ë“ ì±„ì›ë‹ˆë‹¤ (2047ëª…ê¹Œì§€).
            </div>
            <form class="test-form" id="cubeFillForm">
                <button type="submit" class="btn-success">
                    ê²Œì„ ì±„ìš°ê¸° ì‹¤í–‰
                </button>
            </form>
            <div id="cubeFillResult"></div>
        </div>

        <!-- Cube Game Reset í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ”„ Cube Game Reset í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>testResetCubeGame:</strong> í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Cube ê²Œì„ì„ ì—†ì• ê³  ê°•ì œë¡œ ìƒˆë¡œìš´ ê²Œì„ì„ ìƒì„±í•©ë‹ˆë‹¤.
            </div>
            <form class="test-form" id="cubeResetForm">
                <button type="submit" class="btn-danger">
                    ê²Œì„ ë¦¬ì…‹ ë° ìƒˆ ê²Œì„ ìƒì„±
                </button>
            </form>
            <div id="cubeResetResult"></div>
        </div>

        <!-- VIP ì„¤ì • í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ‘‘ VIP ì„¤ì • í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box">
                <strong>setAllUsersVip:</strong> ëª¨ë“  ê¸°ì¡´ ìœ ì €ì˜ membershipì„ 'vip'ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
                <br><br>
                <strong>ì£¼ì˜:</strong> ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ìœ ì €ê°€ VIP ê²Œì„ì— ì°¸ì—¬í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
            </div>
            <form class="test-form" id="setAllUsersVipForm">
                <button type="submit" class="btn-success">
                    ğŸ‘‘ ëª¨ë“  ìœ ì €ë¥¼ VIPë¡œ ì„¤ì •
                </button>
            </form>
            <div id="setAllUsersVipResult"></div>
        </div>

        <!-- ì „ì²´ ë°ì´í„° ë¦¬ì…‹ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section" style="border: 3px solid #dc3545; background: #fff5f5;">
            <h2 style="color: #dc3545;">âš ï¸ ì „ì²´ ë°ì´í„° ë¦¬ì…‹ í…ŒìŠ¤íŠ¸</h2>
            <div class="info-box" style="background: #ffe6e6; border-color: #ff9999;">
                <strong style="color: #dc3545;">testResetAllData:</strong> ë‹¤ìŒ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤:
                <ul style="margin-top: 10px; margin-left: 20px; color: #721c24;">
                    <li>ëª¨ë“  gameHistory (ëª¨ë“  ìœ ì €ì˜ ê²Œì„ íˆìŠ¤í† ë¦¬)</li>
                    <li>ëª¨ë“  Matching ê²Œì„ (Order / Random ê²Œì„)</li>
                    <li>ëª¨ë“  Cube ê²Œì„</li>
                    <li>ëª¨ë“  ìœ ì € ë°ì´í„°</li>
                    <li>ëª¨ë“  Ledger ê¸°ë¡</li>
                </ul>
                <strong style="color: #dc3545; display: block; margin-top: 10px;">âš ï¸ ê²½ê³ : ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</strong>
            </div>
            <form class="test-form" id="resetAllDataForm">
                <button type="submit" class="btn-danger" style="background: #dc3545; font-size: 18px; padding: 15px 30px;">
                    ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ
                </button>
            </form>
            <div id="resetAllDataResult"></div>
        </div>
    </div>

    <!-- Firebase Configuration (loaded from .env) -->
    <script src="./firebase-config.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';

        // Firebase ì„¤ì • (firebase-config.jsì—ì„œ ë¡œë“œ)
        const firebaseConfig = window.firebaseConfig;

        // Firebase ì´ˆê¸°í™”
        console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì‹œì‘...');
        const app = initializeApp(firebaseConfig);
        console.log('âœ… Firebase App ì´ˆê¸°í™” ì™„ë£Œ');
        
        const auth = getAuth(app);
        console.log('âœ… Firebase Auth ì´ˆê¸°í™” ì™„ë£Œ');
        
        const functions = getFunctions(app, 'us-central1'); // us-central1 ë¦¬ì „ ì§€ì •
        console.log('âœ… Firebase Functions ì´ˆê¸°í™” ì™„ë£Œ (ë¦¬ì „: us-central1)');

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.firebaseAuth = auth;
        window.firebaseFunctions = functions;
        window.httpsCallable = httpsCallable;

        // ì¸ì¦ ìƒíƒœ í™•ì¸
        const authStatusDiv = document.getElementById('authStatus');
        const userInfoDiv = document.getElementById('userInfo');
        
        // ì´ˆê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
        authStatusDiv.innerHTML = `
            <div>âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ</div>
            <div style="margin-top: 5px; font-size: 12px; color: #666;">ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...</div>
        `;

        let loginErrorDiv = null;

        function updateAuthStatus(user) {
            if (user) {
                authStatusDiv.className = 'auth-status authenticated';
                authStatusDiv.innerHTML = `
                    <div>âœ… ì¸ì¦ ì™„ë£Œ</div>
                    <div class="user-info">ì´ë©”ì¼: ${user.email || 'N/A'}</div>
                    <div class="user-info">UID: ${user.uid}</div>
                    <button onclick="handleLogout()" style="margin-top: 10px; padding: 5px 15px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>
                `;
                if (loginErrorDiv) {
                    loginErrorDiv.remove();
                    loginErrorDiv = null;
                }
            } else {
                authStatusDiv.className = 'auth-status not-authenticated';
                authStatusDiv.innerHTML = `
                    <div>âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
                    <div id="loginForm" style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                        <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼" style="padding: 8px; border: 2px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding: 8px; border: 2px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        <button id="loginButton" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">ë¡œê·¸ì¸</button>
                    </div>
                    <div id="loginError" style="margin-top: 10px; display: none;"></div>
                `;
                
                // ë¡œê·¸ì¸ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setTimeout(() => {
                    const loginButton = document.getElementById('loginButton');
                    const loginEmail = document.getElementById('loginEmail');
                    const loginPassword = document.getElementById('loginPassword');
                    const loginErrorContainer = document.getElementById('loginError');
                    
                    if (loginButton) {
                        loginButton.addEventListener('click', async () => {
                            await handleLogin();
                        });
                        
                        // Enter í‚¤ë¡œ ë¡œê·¸ì¸
                        if (loginEmail) {
                            loginEmail.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') {
                                    handleLogin();
                                }
                            });
                        }
                        
                        if (loginPassword) {
                            loginPassword.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') {
                                    handleLogin();
                                }
                            });
                        }
                    }
                }, 100);
            }
        }

        async function handleLogin() {
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            const errorContainer = document.getElementById('loginError');
            const loginButton = document.getElementById('loginButton');
            
            if (!emailInput || !passwordInput) {
                console.error('ë¡œê·¸ì¸ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                if (errorContainer) {
                    errorContainer.style.display = 'block';
                    errorContainer.style.background = '#f8d7da';
                    errorContainer.style.color = '#721c24';
                    errorContainer.style.padding = '10px';
                    errorContainer.style.borderRadius = '4px';
                    errorContainer.style.fontSize = '13px';
                    errorContainer.textContent = 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                }
                return;
            }

            // ë¡œë”© ìƒíƒœ
            if (loginButton) {
                loginButton.disabled = true;
                loginButton.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            }

            try {
                console.log('ë¡œê·¸ì¸ ì‹œë„ ì¤‘...', email);
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
                
                if (errorContainer) {
                    errorContainer.style.display = 'none';
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        break;
                    default:
                        errorMessage = `ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message || error.code}`;
                }
                
                if (errorContainer) {
                    errorContainer.style.display = 'block';
                    errorContainer.style.background = '#f8d7da';
                    errorContainer.style.color = '#721c24';
                    errorContainer.style.padding = '10px';
                    errorContainer.style.borderRadius = '4px';
                    errorContainer.style.fontSize = '13px';
                    errorContainer.textContent = errorMessage;
                }
            } finally {
                if (loginButton) {
                    loginButton.disabled = false;
                    loginButton.textContent = 'ë¡œê·¸ì¸';
                }
            }
        }

        window.handleLogin = handleLogin;
        window.handleLogout = async function() {
            try {
                await signOut(auth);
                console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                alert(`ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${error.message}`);
            }
        };

        // ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
        onAuthStateChanged(auth, (user) => {
            console.log('ì¸ì¦ ìƒíƒœ ë³€ê²½:', user ? `ë¡œê·¸ì¸ë¨: ${user.email}` : 'ë¡œê·¸ì•„ì›ƒë¨');
            updateAuthStatus(user);
        }, (error) => {
            console.error('ì¸ì¦ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
            authStatusDiv.className = 'auth-status not-authenticated';
            authStatusDiv.innerHTML = `
                <div>âŒ Firebase ì¸ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
                <div style="margin-top: 10px; font-size: 12px; color: #666;">${error.message}</div>
            `;
        });

        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function showResult(containerId, result, isError = false) {
            const container = document.getElementById(containerId);
            container.className = `result ${isError ? 'error' : 'success'}`;
            container.textContent = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
        }

        // Matching Game í…ŒìŠ¤íŠ¸
        document.getElementById('matchingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const gameId = document.getElementById('matchingGameId').value;
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('matchingResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‹¤í–‰ ì¤‘...<span class="loading"></span>';

            try {
                const testMatchingGameSettlement = httpsCallable(functions, 'testMatchingGameSettlement');
                const result = await testMatchingGameSettlement({ gameId });

                showResult('matchingResult', `âœ… ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('matchingResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // Matching Game Fixed Winning Numbers í…ŒìŠ¤íŠ¸
        document.getElementById('matchingFixedWinningForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const gameId = document.getElementById('matchingFixedGameId').value;
            const winningNumbers = [
                parseInt(document.getElementById('winningBTC').value),
                parseInt(document.getElementById('winningETH').value),
                parseInt(document.getElementById('winningXRP').value),
                parseInt(document.getElementById('winningBNB').value),
                parseInt(document.getElementById('winningSOL').value),
                parseInt(document.getElementById('winningDOGE').value),
                parseInt(document.getElementById('winningTRX').value)
            ];
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('matchingFixedWinningResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            // ê²€ì¦
            if (winningNumbers.some(num => isNaN(num) || num < 0 || num > 9)) {
                showResult('matchingFixedWinningResult', 'âŒ ëª¨ë“  ìˆ«ìëŠ” 0-9 ì‚¬ì´ì˜ ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', true);
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‹¤í–‰ ì¤‘...<span class="loading"></span>';

            try {
                const testMatchingGameWithWinningNumbers = httpsCallable(functions, 'testMatchingGameWithWinningNumbers');
                const result = await testMatchingGameWithWinningNumbers({ 
                    gameId,
                    winningNumbers
                });

                const coinOrder = ['BTC', 'ETH', 'XRP', 'BNB', 'SOL', 'DOGE', 'TRX'];
                const winningNumbersText = winningNumbers.map((num, idx) => `${coinOrder[idx]}: ${num}`).join(', ');
                
                showResult('matchingFixedWinningResult', 
                    `âœ… ì„±ê³µ!\n\nê²Œì„ íƒ€ì…: ${result.data.gameType}\në‹¹ì²¨ ë²ˆí˜¸: [${winningNumbers.join(', ')}]\n(${winningNumbersText})\n\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('matchingFixedWinningResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // Cube Game í…ŒìŠ¤íŠ¸
        document.getElementById('cubeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showResult('cubeResult', 'âš ï¸ ì´ í…ŒìŠ¤íŠ¸ëŠ” ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. "Cube Game Fixed Move í…ŒìŠ¤íŠ¸" ì„¹ì…˜ì„ ì‚¬ìš©í•˜ì„¸ìš”.', true);
        });

        // Cube Game Fixed Move í…ŒìŠ¤íŠ¸
        const cubeFillCheckbox = document.getElementById('cubeFillEmpty');
        const cubeUseAuthCheckbox = document.getElementById('cubeUseAuthFiller');
        const cubeFillerFields = document.getElementById('cubeFillerFields');

        function toggleCubeFillerFields() {
            if (!cubeFillerFields) return;
            const shouldShow = cubeFillCheckbox.checked && !cubeUseAuthCheckbox.checked;
            cubeFillerFields.style.display = shouldShow ? 'flex' : 'none';
        }

        cubeFillCheckbox.addEventListener('change', toggleCubeFillerFields);
        cubeUseAuthCheckbox.addEventListener('change', toggleCubeFillerFields);
        toggleCubeFillerFields();

        document.getElementById('cubeFixedMoveForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const gameId = document.getElementById('cubeFixedMoveGameId').value.trim();
            const direction = parseInt(document.getElementById('cubeDirection').value);
            const moveDistance = parseInt(document.getElementById('cubeMoveDistance').value);
            const fillEmptyPositions = document.getElementById('cubeFillEmpty').checked;
            const useAuthFiller = document.getElementById('cubeUseAuthFiller').checked;
            const fillerUid = document.getElementById('cubeFillerUid').value.trim();
            const fillerEmail = document.getElementById('cubeFillerEmail').value.trim();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('cubeFixedMoveResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            if (direction !== -1 && direction !== 1) {
                showResult('cubeFixedMoveResult', 'âŒ Directionì€ -1 (ì™¼ìª½) ë˜ëŠ” 1 (ì˜¤ë¥¸ìª½)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.', true);
                return;
            }

            if (moveDistance < 0) {
                showResult('cubeFixedMoveResult', 'âŒ MoveDistanceëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', true);
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‹¤í–‰ ì¤‘...<span class="loading"></span>';

            try {
                const testCubeGameWithFixedMove = httpsCallable(functions, 'testCubeGameWithFixedMove');
                const payload = { 
                    gameId: gameId || undefined,
                    direction,
                    moveDistance
                };

                if (fillEmptyPositions) {
                    payload.fillEmptyPositions = true;
                    if (useAuthFiller) {
                        payload.useAuthUserAsFiller = true;
                    } else {
                        if (fillerUid) {
                            payload.fillerUid = fillerUid;
                        }
                        if (fillerEmail) {
                            payload.fillerEmail = fillerEmail;
                        }
                    }
                }

                const result = await testCubeGameWithFixedMove(payload);
                const fillSummary = result?.data?.fillResult
                    ? `í•„ë“œëœ ë¹ˆ Pot: ${result.data.fillResult.created}ê°œ\n`
                    : '';

                showResult('cubeFixedMoveResult', `âœ… ì„±ê³µ!\n${fillSummary}\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('cubeFixedMoveResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // Cube Game Fill í…ŒìŠ¤íŠ¸
        document.getElementById('cubeFillForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('cubeFillResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‹¤í–‰ ì¤‘...<span class="loading"></span>';

            try {
                const testFillCubeGame = httpsCallable(functions, 'testFillCubeGame');
                const result = await testFillCubeGame({});

                showResult('cubeFillResult', `âœ… ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('cubeFillResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // Cube Game Reset í…ŒìŠ¤íŠ¸
        document.getElementById('cubeResetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('cubeResetResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            // í™•ì¸ ë©”ì‹œì§€
            if (!confirm('í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Cube ê²Œì„ì„ ì¢…ë£Œí•˜ê³  ìƒˆ ê²Œì„ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‹¤í–‰ ì¤‘...<span class="loading"></span>';

            try {
                const testResetCubeGame = httpsCallable(functions, 'testResetCubeGame');
                const result = await testResetCubeGame({});

                showResult('cubeResetResult', `âœ… ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('cubeResetResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // VIP ì„¤ì • í…ŒìŠ¤íŠ¸
        document.getElementById('setAllUsersVipForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('setAllUsersVipResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            // í™•ì¸ ë©”ì‹œì§€
            if (!confirm('ëª¨ë“  ê¸°ì¡´ ìœ ì €ë¥¼ VIPë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì„¤ì • ì¤‘...<span class="loading"></span>';

            try {
                const setAllUsersVip = httpsCallable(functions, 'setAllUsersVip');
                const result = await setAllUsersVip({});

                showResult('setAllUsersVipResult', 
                    `âœ… ì„±ê³µ!\n\n${result.data.message}\n\nì—…ë°ì´íŠ¸ëœ ìœ ì € ìˆ˜: ${result.data.usersUpdated}ëª…\n\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                showResult('setAllUsersVipResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        // ì „ì²´ ë°ì´í„° ë¦¬ì…‹ í…ŒìŠ¤íŠ¸
        document.getElementById('resetAllDataForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;

            if (!auth.currentUser) {
                showResult('resetAllDataResult', 'âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', true);
                return;
            }

            // ê°•ë ¥í•œ í™•ì¸ ë©”ì‹œì§€ (2ë‹¨ê³„ í™•ì¸)
            const firstConfirm = confirm(
                'âš ï¸ ê²½ê³ : ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!\n\n' +
                'ë‹¤ìŒ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤:\n' +
                'â€¢ ëª¨ë“  gameHistory\n' +
                'â€¢ ëª¨ë“  Matching ê²Œì„ (Order/Random)\n' +
                'â€¢ ëª¨ë“  Cube ê²Œì„\n' +
                'â€¢ ëª¨ë“  ìœ ì € ë°ì´í„°\n' +
                'â€¢ ëª¨ë“  Ledger ê¸°ë¡\n\n' +
                'ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\n\n' +
                'ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            );

            if (!firstConfirm) {
                return;
            }

            const secondConfirm = confirm(
                'âš ï¸ ìµœì¢… í™•ì¸\n\n' +
                'ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' +
                'ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!'
            );

            if (!secondConfirm) {
                return;
            }

            button.disabled = true;
            button.innerHTML = 'ì‚­ì œ ì¤‘...<span class="loading"></span>';

            try {
                const testResetAllData = httpsCallable(functions, 'testResetAllData');
                const result = await testResetAllData({});

                const gamesCreatedText = result.data.gamesCreated
                    ? `\n\nìƒì„±ëœ ê²Œì„:\n` +
                      `â€¢ Order ê²Œì„: ${result.data.gamesCreated.orderGames.created}ê°œ\n` +
                      `â€¢ Random ê²Œì„: ${result.data.gamesCreated.randomGames.created}ê°œ\n` +
                      `â€¢ Cube ê²Œì„: ${result.data.gamesCreated.cubeGame.created ? '1ê°œ' : '0ê°œ'}\n` +
                      `ì´ ìƒì„±: ${result.data.totalGamesCreated || 0}ê°œ`
                    : '';

                const resultText = result.data.success
                    ? `âœ… ì„±ê³µ!\n\n${result.data.message}${gamesCreatedText}\n\nì‚­ì œëœ í•­ëª©:\n${JSON.stringify(result.data.results, null, 2)}`
                    : `âš ï¸ ì™„ë£Œ (ì¼ë¶€ ì˜¤ë¥˜ ë°œìƒ)\n\n${result.data.message}${gamesCreatedText}\n\nê²°ê³¼:\n${JSON.stringify(result.data.results, null, 2)}`;

                showResult('resetAllDataResult', resultText, !result.data.success);
            } catch (error) {
                showResult('resetAllDataResult', `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${error.message}\n\n${error.stack || ''}`, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        });

        console.log('âœ… í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>
